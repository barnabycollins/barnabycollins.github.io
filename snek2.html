<!-- Lets make a simple snake game -->
<!-- Based on original code created by thecodeplayer.com -->

<!-- create a canvas element for the code to manipulate -->
<canvas id="canvas" width="1200" height="600"></canvas>

<!-- And our snake code -->
<script src="snakecore2.js"></script>

<script>

	//creates the snake ready for the start of the game
	function create_snake()
	{
		snake_array = []; //Empty array to start with
		
		snake_array[0] = {x: 6, y:0}; //position 0 in the array is the head of the snake
		snake_array[1] = {x: 5, y:0};
		snake_array[2] = {x: 4, y:0};
	}

	//set it so that when the user hits a key the keystroke function is called
	document.onkeydown = keystroke

	function keystroke(evt)
	{
		if(evt.keyCode == 37) d = "left";
		else if (evt.keyCode == 38) d = "up";
		else if (evt.keyCode == 39) d = "right";
		else if (evt.keyCode == 40) d = "down";
		
	}

	//The movement code for the snake, including eating food, and checking for crashes
	function update_snake(direction)
	{
		//We need to calculate the x position and y position of the new head
		//First get the current position of the head of the snake.
		var nx = snake_array[0].x;
		var ny = snake_array[0].y;
		
		//Now adjust these values according to the direction of travel
		if(direction == "right") nx++;
		else if(direction == "left") nx--;
		else if(direction == "up") ny--;
		else if(direction == "down") ny++;
		//nx and ny now contain the new x and new y positions of the head

		//Now check for game over conditions
		//This will restart the game if the snake hits the wall or its own body
		if(check_collision(nx, ny, snake_array))
		{
			//restart game
			init();
			return;
		}
		
		var newhead = {x: nx, y: ny};
		snake_array.unshift(newhead);
		if(nx == food.x && ny == food.y){
			create_food();
			score = score + 1;
		}
		else {
			snake_array.pop(); //pops out the last cell (the end of the tail)
		}
		//create_food();
	}
	
	//Lets create the food now
	function create_food()
	{
		//TODO: set the food to a random position: x= 0 to maxx, y=0 to maxy
		food = {
			x: Math.round(Math.random() * maxx), 
			y: Math.round(Math.random() * maxy), 
		};
	}
		
	//returns true if the snake has hit a wall
	//or if it has hit itself (x and y exist in the array)
	function check_collision(x, y, array)
	{	
		for(var i=0; i < array.length; i = i + 1)
		{
			if(array[i].x == x && array[i].y == y)
			{
				return true;
			}
		}
		
		if(x < 0 || x >= maxx || y < 0 || y >= maxy) {
			return true;
		}
		else {
			return false;
		}

	}

</script>